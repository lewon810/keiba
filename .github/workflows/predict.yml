name: Predict

on:
  workflow_dispatch:
  schedule:
    # Run every 3 hours to capture new odds/data
    - cron: '0 */3 * * *'

permissions:
  contents: read
  pages: write
  id-token: write
  actions: read

jobs:
  predict:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Train Model
      run: |
        export PYTHONPATH=$PYTHONPATH:.
        python -m train.train

    - name: Run Predictions (HTML Report)
      run: |
        export PYTHONPATH=$PYTHONPATH:.
        python -m app.report.predict_html_generator

    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: prediction-artifact
        path: predict.html

  # predict完了後にGitHub Pagesへ自動デプロイ
  deploy:
    needs: predict
    uses: ./.github/workflows/deploy.yml
    with:
      source: predict
    permissions:
      contents: read
      pages: write
      id-token: write
      actions: read
