name: Learn and Evaluate

on:
  workflow_dispatch:
  schedule:
    # Run weekly or so? User didn't specify schedule prefernce for this one.
    - cron: '0 0 * * 1' # Every Monday

jobs:
  evaluate:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install matplotlib

    - name: Train Model (2016-2024)
      # Assumes raw data is present in repo or cached. 
      # User stated: "Use CSVs in master branch raw folder".
      run: |
        export PYTHONPATH=$PYTHONPATH:.
        python -m train.train --start 2016 --end 2024

    - name: Generate Evaluation Report (2025)
      run: |
        export PYTHONPATH=$PYTHONPATH:.
        # Ensure report dir exists
        mkdir -p train/report
        python -m train.report.evaluate_html_generator --start 2025 --end 2025 --output evaluate.html

    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: evaluation-artifact
        path: evaluate.html
